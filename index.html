<!DOCTYPE html><html lang="fa">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ماشین حساب سود سرمایه‌گذاری</title>
  <style>
    body {
      font-family: IranSans, sans-serif;
      direction: rtl;
      background-color: #f5f5f5;
      margin: 0;
      padding: 0;
      text-align: center;
      color: #2d0c59;
    }
    .container {
      max-width: 400px;
      background: white;
      margin: 30px auto;
      padding: 30px;
      border-radius: 25px;
    }
    img.logo {
      width: 90px;
      margin-bottom: 10px;
    }
    h1 {
      font-size: 22px;
      margin: 10px 0;
    }
    p {
      font-size: 14px;
      margin-bottom: 20px;
    }
    select {
      width: 100%;
      padding: 12px;
      margin-bottom: 15px;
      font-size: 15px;
      border-radius: 12px;
      border: 1px solid #ccc;
      text-align: right;
    }
    input {
      width: 100%;
      padding: 12px;
      margin-bottom: 15px;
      font-size: 15px;
      border-radius: 12px;
      border: 1px solid #ccc;
      text-align: right;
      direction: ltr;
      box-sizing: border-box;
    }
    button {
      background-color: #121212;
      color: white;
      border: none;
      padding: 14px;
      font-size: 16px;
      border-radius: 12px;
      cursor: pointer;
      width: 100%;
      margin-bottom: 15px;
    }
    .result {
      background-color: #fafafa;
      padding: 18px;
      border-radius: 14px;
    }
    /* استایل شمارنده استفاده */
    .usage-counter {
      margin-top: 40px;
      font-size: 14px;
      color: #555;
    }
  </style>
</head>
<body>
  <div class="container">
    <img src="https://uploadkon.ir/uploads/8c7604_25file-0000000073346243969ca320550ec0a2.png" class="logo" alt="Repay Logo">
    <h1>ماشین حساب سود سرمایه‌گذاری</h1>
    <p>مبلغ را وارد کنید، طرح و مدت را انتخاب کنید تا سود ماهانه، کل سود، کارمزد و مبلغ نهایی را ببینید.</p>

    <select id="plan" onchange="updateDurations()">
      <option value="gold">🥇 طرح طلایی</option>
      <option value="silver">🥈 طرح نقره‌ای</option>
      <option value="bronze">🥉 طرح برنزی</option>
    </select>

    <select id="duration"></select>

    <input id="amount" type="text" placeholder="حداقل مبلغ ۲۵٬۰۰۰٬۰۰۰ تومان">

    <button onclick="calculateProfit()">محاسبه</button>

    <div class="result" id="result"></div>

    <!-- شمارنده استفاده -->
    <div class="usage-counter">
      📊 تعداد استفاده از ماشین‌حساب: <span id="useCount">0</span>
    </div>
  </div>

  <script>
    const plans = {
      gold: { min: 25000000, feePercent: 2, profits: { '3': 13, '6': 27, '12': 59, '24': 123 } },
      silver: { min: 10000000, feePercent: 1, profits: { '3': 9, '6': 20, '12': 52, '24': 114 } },
      bronze: { min: 5000000, feePercent: 0, profits: { '3': 6, '6': 15, '12': 36, '24': 96 } }
    };

    function numberWithCommas(x) {
      return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }
    function formatInputAmount(e) {
      const input = e.target;
      const raw = input.value.replace(/[^\d]/g, '');
      input.value = numberWithCommas(raw);
    }

    function updateDurations() {
      const plan = document.getElementById("plan").value;
      const durations = plans[plan].profits;
      const select = document.getElementById("duration");
      select.innerHTML = "";
      for (const [months, percent] of Object.entries(durations)) {
        let text = `${months} ماهه – ${percent}%`;
        const option = document.createElement("option");
        option.value = months;
        option.textContent = text;
        if (months === '24') option.selected = true;
        select.appendChild(option);
      }
      const input = document.getElementById("amount");
      input.placeholder = `حداقل مبلغ ${numberWithCommas(plans[plan].min)} تومان`;
    }

    function calculateProfit() {
      const planKey = document.getElementById("plan").value;
      const months = document.getElementById("duration").value;
      const rawAmount = document.getElementById("amount").value.replace(/[^\d]/g, '');
      const amount = parseInt(rawAmount);
      const plan = plans[planKey];

      if (isNaN(amount) || amount < plan.min) {
        alert(`حداقل مبلغ برای ${document.getElementById("plan").selectedOptions[0].text} ${numberWithCommas(plan.min)} تومان است.`);
        return;
      }

      const percent = plan.profits[months];
      const totalProfit = Math.round((amount * percent) / 100);
      const monthlyProfit = Math.round(totalProfit / months);
      const fee = Math.round((plan.feePercent / 100) * (amount + totalProfit));
      const finalAmount = amount + totalProfit - fee;
      const feeText = plan.feePercent === 0 ? "بدون کارمزد" : `${plan.feePercent}%`;

      document.getElementById("result").innerHTML =
        `<div>
          سود ماهانه: ${numberWithCommas(monthlyProfit)} تومان<br>
          سود کل: ${numberWithCommas(totalProfit)} تومان<br>
          کارمزد: ${feeText}<br>
          مبلغ قابل برداشت نهایی: ${numberWithCommas(finalAmount)} تومان
        </div>`;

      // افزایش شمارنده استفاده
      updateCounter();
    }

    // شمارنده استفاده با countapi
    <script>
  const COUNTER_NS  = 'repay_calc';      // اگر خواستی، نام دلخواهت
  const COUNTER_KEY = 'usage_count';     // اگر خواستی، نام دلخواهت
  const URL_GET = `https://api.countapi.xyz/get/${COUNTER_NS}/${COUNTER_KEY}`;
  const URL_HIT = `https://api.countapi.xyz/hit/${COUNTER_NS}/${COUNTER_KEY}`;

  // JSONP fallback برای دور زدن CORS/AdBlock
  function jsonp(url) {
    return new Promise((resolve, reject) => {
      const cb = 'cb_' + Math.random().toString(36).slice(2);
      window[cb] = data => { resolve(data); cleanup(); };
      const s = document.createElement('script');
      s.src = url + (url.includes('?') ? '&' : '?') + 'callback=' + cb;
      s.onerror = () => { reject(); cleanup(); };
      document.body.appendChild(s);
      function cleanup() { delete window[cb]; s.remove(); }
    });
  }

  function setCount(v) {
    document.getElementById('useCount').innerText = (v ?? 0);
  }

  function getCurrentCount() {
    fetch(URL_GET)
      .then(r => r.json())
      .then(d => setCount(d.value))
      .catch(() => {
        jsonp(URL_GET)
          .then(d => setCount(d.value))
          .catch(() => setCount(0));
      });
  }

  function updateCounter() {
    // افزایش خوش‌بینانه برای فیدبک فوری
    const el = document.getElementById('useCount');
    el.innerText = (parseInt(el.innerText || '0', 10) + 1);

    fetch(URL_HIT)
      .then(r => r.json())
      .then(d => setCount(d.value))
      .catch(() => {
        jsonp(URL_HIT)
          .then(d => setCount(d.value))
          .catch(() => { /* اگر نشد، همان مقدار خوش‌بینانه می‌ماند */ });
      });
  }

    updateDurations();
    document.getElementById("amount").addEventListener("input", formatInputAmount);
    document.addEventListener("DOMContentLoaded", getCurrentCount);
  </script>
</body>
</html>
